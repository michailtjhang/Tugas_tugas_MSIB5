* QUERY VIEW INDEX & TRANSACTION *

* TUGAS PERTEMUAN 08 *


* Soal 5.1 *
// No. 1
CREATE VIEW pesanan_pelanggan_kartu
AS SELECT pesanan.id, pesanan.tanggal, pesanan.total, pelanggan.kode, pelanggan.nama, kartu.nama AS nama_kartu, kartu.diskon
FROM pesanan 
INNER JOIN pelanggan ON pesanan.pelanggan_id = pelanggan.id
INNER JOIN kartu ON pelanggan.kartu_id = kartu.id;

// No. 2
CREATE VIEW pembelian_produk_vendor
AS SELECT pembelian.id, pembelian.tanggal, pembelian.nomor, pembelian.jumlah, pembelian.harga, produk.nama AS nama_produk, vendor.nama AS nama_vendor, vendor.kontak
FROM pembelian 
INNER JOIN produk ON pembelian.produk_id = produk.id 
INNER JOIN vendor ON pembelian.vendor_id = vendor.id;

// No. 3
CREATE VIEW pesanan_produk_kategori
AS SELECT pesanan.id, pesanan.tanggal, pesanan.total, pelanggan.nama, produk.kode, produk.nama AS nama_produk, jenis_produk.nama AS jenis_produk, pesanan_items.qty, pesanan_items.harga AS harga_jual
FROM pesanan 
INNER JOIN pelanggan ON pesanan.pelanggan_id = pelanggan.id
INNER JOIN pesanan_items ON pesanan.id = pesanan_items.pesanan_id
INNER JOIN produk ON pesanan_items.produk_id = produk.id
INNER JOIN jenis_produk ON produk.jenis_produk_id = jenis_produk.id;

* Soal 5.2 *
//No. 1
START TRANSACTION;

-- Insert data produk sebanyak 3 record --
INSERT INTO produk (kode, nama, harga_beli, harga_jual, stok, min_stok, jenis_produk_id) VALUES
('M002', 'Meja Kayu', 500000, 700000, 15, 5, 2),
('KS01', 'Keripik Singkong', 10000, 15000, 50, 10, 3),
('SP01', 'Smartphone Samsung', 8000000, 10000000, 20, 3, 1);

-- Update data stok salah satu produk --
UPDATE produk set stok = 12 WHERE nama = 'Meja Makan';

-- Buat savepoint --
SAVEPOINT update_produk;

-- Hapus salah satu data pembayaran --
DELETE FROM pembayaran WHERE id = 1;

-- Kembali ke savepoint --
ROLLBACK TO SAVEPOINT update_produk;

-- Update data iuran salah satu kartu --
UPDATE kartu SET iuran = 25000 WHERE id = 7;

-- Akhiri transaction dengan commit
COMMIT;